(self.webpackChunkai_frontend=self.webpackChunkai_frontend||[]).push([[246],{47682:function(V,m,e){"use strict";e.r(m),e.d(m,{default:function(){return te}});var j=e(30279),g=e.n(j),y=e(94434),N=e.n(y),$=e(35290),c=e.n($),z=e(411),Z=e.n(z),J=e(46686),h=e.n(J),o=e(93236),b=e(65713),H=e(41385),x=e(86004),U=e(929),Q=e(17986),X=e(66122),Y=e(61654),w=e(87976);function k(){return F.apply(this,arguments)}function F(){return F=Z()(c()().mark(function S(){return c()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",w.Z.get("oss/sign"));case 1:case"end":return f.stop()}},S)})),F.apply(this,arguments)}var q=e(47277),_=e(12383),ee=e(17771),ae={preview:"preview___Rqv6O"},D=e(32699),i=e(62086),ne=(0,o.memo)(function(S){var C=S.value,f=S.onChange,R=f===void 0?function(){}:f,re=(0,o.useState)(),I=h()(re,2),r=I[0],ue=I[1],se=(0,o.useState)(C),L=h()(se,2),l=L[0],A=L[1],ie=(0,o.useState)(null),T=h()(ie,2),P=T[0],E=T[1],le=(0,o.useState)("url"),M=h()(le,2),p=M[0],oe=M[1],ve=(0,o.useState)([]),W=h()(ve,2),v=W[0],B=W[1],de=(0,ee.A)({sources:[{src:l}]}),fe=de.Video,ce=(0,q.Z)(R,{wait:300}),G=ce.run;(0,_.Z)(function(){A(C)},[C]);var K=function(){var n=Z()(c()().mark(function a(){var t,u;return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,k();case 3:u=s.sent,ue(u==null||(t=u.data)===null||t===void 0?void 0:t.data),s.next=11;break;case 7:s.prev=7,s.t0=s.catch(0),console.error(s.t0),b.ZP.error("\u4E0A\u4F20\u5931\u8D25,\u8BF7\u7A0D\u540E\u91CD\u8BD5");case 11:case"end":return s.stop()}},a,null,[[0,7]])}));return function(){return n.apply(this,arguments)}}();(0,o.useEffect)(function(){p==="upload"&&K()},[p]),(0,o.useEffect)(function(){if(v&&v.length){var n=v==null?void 0:v[0];if((n==null?void 0:n.percent)===100){var a,t;A((r==null?void 0:r.host)+"/"+(n==null?void 0:n.url));var u=null;n!=null&&(a=n.type)!==null&&a!==void 0&&a.startsWith("image")&&(u="image"),n!=null&&(t=n.type)!==null&&t!==void 0&&t.startsWith("video")&&(u="video"),E(u)}}},[r,v,R]);var he=function(a){var t=a.fileList,u=t===void 0?[]:t;B(N()(u))},pe=function(a){var t=(v||[]).filter(function(u){return u.url!==a.url});B(t)},me=function(a){return{key:a.url,OSSAccessKeyId:r==null?void 0:r.OSSAccessKeyId,policy:r==null?void 0:r.policy,Signature:r==null?void 0:r.Signature}},ge=function(){var n=Z()(c()().mark(function a(t){var u,O,s;return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(r){d.next=2;break}return d.abrupt("return",!1);case 2:if(u=Number(r.expire)*1e3,!(u<Date.now())){d.next=6;break}return d.next=6,K();case 6:return O=t.name.slice(t.name.lastIndexOf(".")),s=Date.now()+O,t.url=r.dir+"/"+s,d.abrupt("return",t);case 10:case"end":return d.stop()}},a)}));return function(t){return n.apply(this,arguments)}}(),Se={name:"file",fileList:v,multiple:!1,maxCount:1,accept:"video/*, image/*",action:r==null?void 0:r.host,onChange:he,onRemove:pe,data:me,beforeUpload:ge},Ce=function(a){var t=a.target.value;A(t)};(0,o.useEffect)(function(){l&&((0,D.endsWith)(".mp4",l)&&E("image"),(0,D.endsWith)(".jpg",l)&&E("image"),G(l))},[G,l]);var je=function(){var a=null;return l&&P==="image"&&(a=(0,i.jsx)("div",{className:ae.preview,children:(0,i.jsx)(H.Z,{src:l})})),l&&P==="video"&&(a=(0,i.jsx)(fe,{width:400,src:l})),a};return(0,i.jsxs)("div",{children:[je(),(0,i.jsxs)(x.Z.Group,{compact:!0,children:[(0,i.jsxs)(U.Z,{value:p,onChange:function(a){return oe(a)},children:[(0,i.jsx)(U.Z.Option,{value:"url",children:"\u8F93\u5165URL"}),(0,i.jsx)(U.Z.Option,{value:"upload",children:"\u672C\u5730\u4E0A\u4F20"})]}),(0,i.jsx)(x.Z,{value:l,onChange:Ce,disabled:p==="upload",style:{width:"70%"},placeholder:"\u8BF7\u8F93\u5165URL\u5730\u5740"}),p==="upload"?(0,i.jsx)(Q.Z,g()(g()({},Se),{},{children:(0,i.jsx)(X.Z,{style:{marginLeft:6},icon:(0,i.jsx)(Y.Z,{}),children:"\u70B9\u51FB\u4E0A\u4F20"})})):null]})]})}),te=ne},87976:function(V,m,e){"use strict";var j=e(13183),g="http://ai.tbanx.cn",y=j.Z.create({baseURL:"".concat(g,"/api/"),headers:{Authorization:"senv2wk7w4jo93fn(um40lfdc!dycp#fcupm7^1ocdh6d@bn0t"}});m.Z=y},62938:function(){}}]);
